# HG changeset patch
# Parent beaa93d4f6b523d61d3ababb0a68262a83d76584

diff --git a/js/src/jsapi.h b/js/src/jsapi.h
--- a/js/src/jsapi.h
+++ b/js/src/jsapi.h
@@ -1455,26 +1455,44 @@ struct JSExtendedClass {
     JSClass             base;
     JSEqualityOp        equality;
     JSObjectOp          outerObject;
     JSObjectOp          innerObject;
     JSIteratorOp        iteratorObject;
     JSObjectOp          wrappedObject;          /* NB: infallible, null
                                                    returns are treated as
                                                    the original object */
+    /*
+     * All or none of these virtual property hooks must be null.  If non-null,
+     * they will be consulted by the engine after it checks for real (in-scope)
+     * properties.  These hooks are not themselves required to be aware of real
+     * properties; for instance, if implementing an array-like class, these
+     * hooks would only need to know about the array elements, not .length.
+     */
+    JSBool (*hasOwnVirtualProperty)(JSContext *cx, JSObject *obj, jsid id,
+                                    JSBool *foundp);
+    JSBool (*getOwnVirtualProperty)(JSContext *cx, JSObject *obj, jsid id,
+                                    jsval *vp);
+    JSBool (*setOwnVirtualProperty)(JSContext *cx, JSObject *obj, jsid id,
+                                    jsval *vp);
+    JSBool (*getOwnVirtualDescriptor)(JSContext *cx, JSObject *obj, jsid id,
+                                      JSPropertyDescriptor *desc);
+
     void                (*reserved0)(void);
     void                (*reserved1)(void);
     void                (*reserved2)(void);
 };
 
 #define JSCLASS_HAS_PRIVATE             (1<<0)  /* objects have private slot */
 #define JSCLASS_NEW_ENUMERATE           (1<<1)  /* has JSNewEnumerateOp hook */
 #define JSCLASS_NEW_RESOLVE             (1<<2)  /* has JSNewResolveOp hook */
 #define JSCLASS_PRIVATE_IS_NSISUPPORTS  (1<<3)  /* private is (nsISupports *) */
-/* (1<<4) was JSCLASS_SHARE_ALL_PROPERTIES, now obsolete. See bug 527805. */
+#define JSCLASS_VIRTUAL_RESOLVE         (1<<4)  /* has JSVirtualResolveOp
+                                                   hook */
+/* JSCLASS_SHARE_ALL_PROPERTIES is now obsolete. See bug 527805. */
 #define JSCLASS_NEW_RESOLVE_GETS_START  (1<<5)  /* JSNewResolveOp gets starting
                                                    object in prototype chain
                                                    passed in via *objp in/out
                                                    parameter */
 #define JSCLASS_CONSTRUCT_PROTOTYPE     (1<<6)  /* call constructor on class
                                                    prototype */
 #define JSCLASS_DOCUMENT_OBSERVER       (1<<7)  /* DOM document observer */
 
